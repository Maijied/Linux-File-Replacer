#!/bin/sh
set -e
# Pre-removal script: run before package files are removed.
# Refresh desktop/database caches so removal is reflected immediately.
if command -v update-desktop-database >/dev/null 2>&1; then
  update-desktop-database /usr/share/applications || true
fi
if command -v gtk-update-icon-cache >/dev/null 2>&1; then
  gtk-update-icon-cache -f /usr/share/icons/hicolor || true
fi

# If the removal was invoked via sudo, attempt to call the per-user uninstall
# logic (non-destructive) as that user so their local desktop files are cleaned
# up. This is conservative: it does NOT purge backups. It only runs if
# SUDO_USER is set and is not root.
if [ -n "${SUDO_USER:-}" ] && [ "${SUDO_USER}" != "root" ]; then
  USER_HOME=$(eval echo ~${SUDO_USER})
  if [ -x "/opt/dbreplacer/uninstall.sh" ]; then
    su - "${SUDO_USER}" -s /bin/sh -c "/opt/dbreplacer/uninstall.sh" || true
  fi
fi

exit 0
